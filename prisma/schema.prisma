generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Gender {
  MALE   @map("male")
  FEMALE @map("female")
}

enum CredentialType {
  PASSWORD @map("password")
}

enum EstadoCargo {
  PENDIENTE  @map("pendiente")
  COMPLETADO @map("completado")
}

enum Naturaleza {
  CARGO @map("cargo")
  ABONO @map("abono")
}

model CatalogoPais {
  id          Int    @id @default(autoincrement())
  description String @db.VarChar(128)
}

model CatalogoTipoCargo {
  id          Int     @id @default(autoincrement())
  description String? @db.VarChar(128)
}

model CatalogoTipoLote {
  id          Int    @id @default(autoincrement())
  description String @db.VarChar(128)
}

model CatalogoTipoPublicacion {
  id          Int    @id @default(autoincrement())
  description String @db.VarChar(128)
}

model Credential {
  userId         Int
  user           User           @relation(fields: [userId], references: [id])
  credentialType CredentialType
  username       String
  payload        Json

  @@id(name: "typeAndUsername", [credentialType, username])
}

model Neighbor {
  id           Int       @id @default(autoincrement())
  workspaceId  Int
  projectId    Int
  name         String    @db.VarChar(256)
  profile      Profile   @relation(fields: [profileId], references: [id])
  profileId    Int       @unique
  // Metadata
  capturedDate DateTime  @default(now())
  capturedById Int
  modifiedDate DateTime?
  modifiedById Int?
  deletedDate  DateTime?
  deletedById  Int?

  @@index([workspaceId])
  @@index([projectId])
}

model User {
  id            Int          @id @default(autoincrement())
  active        Boolean
  profile       Profile      @relation(fields: [profileId], references: [id])
  profileId     Int          @unique
  credentials   Credential[]
  workspaces    Workspace[]
  ownWorkspaces Workspace[]  @relation("owner")
  // Metadata
  capturedDate  DateTime     @default(now())
  capturedBy    User         @relation("capturedBy", fields: [capturedById], references: [id])
  capturedById  Int
  modifiedDate  DateTime?
  modifiedBy    User?        @relation("modifiedBy", fields: [modifiedById], references: [id])
  modifiedById  Int?
  deletedDate   DateTime?
  deletedBy     User?        @relation("deletedBy", fields: [deletedById], references: [id])
  deletedById   Int?
  usersCaptured User[]       @relation("capturedBy")
  usersModified User[]       @relation("modifiedBy")
  usersDeleted  User[]       @relation("deletedBy")
}

model Profile {
  id       Int       @id @default(autoincrement())
  name     String    @db.VarChar(128)
  lastname String    @db.VarChar(128)
  age      Int?
  gender   Gender?
  user     User?
  neighbor Neighbor?
}

model Project {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(128)
  workspace   Workspace @relation(fields: [workspaceId], references: [id])
  workspaceId Int
}

model Workspace {
  id        Int       @id @default(autoincrement())
  name      String    @db.VarChar(128)
  namespace String    @unique @db.VarChar(128)
  projects  Project[]
  users     User[]
  // Control access
  owner     User      @relation("owner", fields: [ownerId], references: [id])
  ownerId   Int
}
